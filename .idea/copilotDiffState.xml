<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/informatique/mtcit/ui/components/RejectionStepContent.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/informatique/mtcit/ui/components/RejectionStepContent.kt" />
              <option name="originalContent" value="package com.informatique.mtcit.ui.components&#10;&#10;import androidx.compose.animation.AnimatedVisibility&#10;import androidx.compose.animation.expandVertically&#10;import androidx.compose.animation.fadeIn&#10;import androidx.compose.animation.fadeOut&#10;import androidx.compose.animation.shrinkVertically&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Cancel&#10;import androidx.compose.material.icons.filled.Info&#10;import androidx.compose.material.icons.filled.KeyboardArrowDown&#10;import androidx.compose.material.icons.filled.KeyboardArrowUp&#10;import androidx.compose.material.icons.filled.Warning&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.informatique.mtcit.R&#10;import com.informatique.mtcit.ui.theme.LocalExtraColors&#10;import com.informatique.mtcit.ui.viewmodels.StepData&#10;import com.informatique.mtcit.ui.components.shared.FormFieldDisplayItem&#10;&#10;/**&#10; * Rejection Step Content Component&#10; * Works like ReviewStepContent but adds rejection reasons and restriction details&#10; * Automatically displays ALL data from previous steps&#10; */&#10;@Composable&#10;fun RejectionStepContent(&#10;    stepData: StepData,&#10;    formData: Map&lt;String, String&gt;,&#10;    allSteps: List&lt;StepData&gt;,&#10;    onBackToHome: () -&gt; Unit,&#10;    onContactSupport: () -&gt; Unit,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    val extraColors = LocalExtraColors.current&#10;&#10;    // Extract metadata&#10;    val reasons = (stepData.metadata?.get(&quot;reasons&quot;) as? List&lt;*&gt;)?.filterIsInstance&lt;String&gt;() ?: emptyList()&#10;    val detailedMessages = (stepData.metadata?.get(&quot;detailedMessages&quot;) as? List&lt;*&gt;)?.filterIsInstance&lt;String&gt;() ?: emptyList()&#10;    val restrictionData = (stepData.metadata?.get(&quot;restrictionData&quot;) as? Map&lt;*, *&gt;)&#10;        ?.mapNotNull { (key, value) -&gt;&#10;            if (key != null &amp;&amp; value != null) key.toString() to value.toString() else null&#10;        }?.toMap()&#10;    val capturedData = (stepData.metadata?.get(&quot;capturedData&quot;) as? Map&lt;*, *&gt;)&#10;        ?.mapNotNull { (key, value) -&gt;&#10;            if (key != null &amp;&amp; value != null) key.toString() to value.toString() else null&#10;        }?.toMap() ?: emptyMap()&#10;    val canGoBack = stepData.metadata?.get(&quot;canGoBack&quot;) as? Boolean ?: true&#10;&#10;    // DEBUG LOG&#10;    android.util.Log.d(&quot;RejectionStepContent&quot;, &quot;Extracted capturedData: $capturedData&quot;)&#10;&#10;    Column(&#10;        modifier = modifier&#10;            .fillMaxSize()&#10;            .verticalScroll(rememberScrollState())&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        // 1. Rejection Icon and Title&#10;        Card(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            colors = CardDefaults.cardColors(containerColor = Color(0xFFFFEBEE)),&#10;            shape = RoundedCornerShape(12.dp)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.fillMaxWidth().padding(20.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Icon(&#10;                    imageVector = Icons.Default.Cancel,&#10;                    contentDescription = null,&#10;                    tint = Color(0xFFD32F2F),&#10;                    modifier = Modifier.size(64.dp)&#10;                )&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;                Text(&#10;                    text = localizedApp(R.string.request_rejected_title),&#10;                    style = MaterialTheme.typography.headlineSmall.copy(fontWeight = FontWeight.Bold),&#10;                    color = Color(0xFFD32F2F)&#10;                )&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Text(&#10;                    text = localizedApp(R.string.request_rejected_desc),&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = extraColors.textSubTitle&#10;                )&#10;            }&#10;        }&#10;&#10;        // 2. Rejection Reasons (Expandable)&#10;        if (reasons.isNotEmpty()) {&#10;            RejectionReasonsCard(reasons, detailedMessages, extraColors)&#10;        }&#10;&#10;        // 3. Restriction Details (Expandable)&#10;        restrictionData?.let {&#10;            if (it.isNotEmpty()) {&#10;                RestrictionDetailsCard(it, extraColors)&#10;            }&#10;        }&#10;&#10;        // 3.5. Captured Data at Point of Rejection (NEW - shows custom data with Arabic labels)&#10;        if (capturedData.isNotEmpty()) {&#10;            CapturedDataCard(capturedData, extraColors)&#10;        }&#10;&#10;        // 4. Entered Data Summary - SAME AS REVIEW STEP (Expandable sections per step)&#10;        Text(&#10;            text = localizedApp(R.string.entered_data_summary),&#10;            style = MaterialTheme.typography.titleLarge.copy(fontWeight = FontWeight.Bold),&#10;            color = extraColors.whiteInDarkMode,&#10;            modifier = Modifier.padding(top = 8.dp)&#10;        )&#10;&#10;        // Display all previous steps data (excluding rejection step itself)&#10;        allSteps.forEachIndexed { index, step -&gt;&#10;            // Skip the rejection step itself and empty steps&#10;            if (step.metadata?.get(&quot;isRejectionStep&quot;) != true &amp;&amp; step.fields.isNotEmpty()) {&#10;                val stepFieldsWithData = step.fields.filter { field -&gt;&#10;                    val value = formData[field.id]&#10;                    !value.isNullOrBlank() &amp;&amp; value != &quot;[]&quot;&#10;                }&#10;&#10;                if (stepFieldsWithData.isNotEmpty()) {&#10;                    ExpandableStepCard(&#10;                        step = step,&#10;                        stepFieldsWithData = stepFieldsWithData,&#10;                        formData = formData,&#10;                        isExpandedByDefault = false, // All collapsed by default in rejection step&#10;                        extraColors = extraColors&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        // 5. Action Buttons&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        Column(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            verticalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            if (canGoBack) {&#10;                Button(&#10;                    onClick = { /* Will be handled by previousStep in ViewModel */ },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = ButtonDefaults.buttonColors(containerColor = extraColors.blue2),&#10;                    shape = RoundedCornerShape(12.dp)&#10;                ) {&#10;                    Text(&#10;                        text = localizedApp(R.string.go_back_and_fix),&#10;                        modifier = Modifier.padding(vertical = 8.dp)&#10;                    )&#10;                }&#10;            }&#10;&#10;            OutlinedButton(&#10;                onClick = onBackToHome,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                shape = RoundedCornerShape(12.dp)&#10;            ) {&#10;                Text(&#10;                    text = localizedApp(R.string.back_to_home),&#10;                    modifier = Modifier.padding(vertical = 8.dp)&#10;                )&#10;            }&#10;&#10;            OutlinedButton(&#10;                onClick = onContactSupport,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                shape = RoundedCornerShape(12.dp)&#10;            ) {&#10;                Text(&#10;                    text = localizedApp(R.string.contact_support),&#10;                    modifier = Modifier.padding(vertical = 8.dp)&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card showing rejection reasons&#10; */&#10;@Composable&#10;private fun RejectionReasonsCard(&#10;    reasons: List&lt;String&gt;,&#10;    detailedMessages: List&lt;String&gt;,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(true) } // Expanded by default&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Warning,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFFFF9800),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = localizedApp(R.string.rejection_reasons),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 12.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.1f)&#10;                    )&#10;                    reasons.forEachIndexed { index, reason -&gt;&#10;                        ReasonItem(reason, detailedMessages.getOrNull(index) ?: &quot;&quot;, index + 1, extraColors)&#10;                        if (index &lt; reasons.size - 1) {&#10;                            Spacer(modifier = Modifier.height(12.dp))&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card showing restriction details from API/backend&#10; */&#10;@Composable&#10;private fun RestrictionDetailsCard(&#10;    restrictionData: Map&lt;String, String&gt;,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(true) } // Expanded by default&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Info,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFF2196F3),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = localizedApp(R.string.restriction_details),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 12.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.1f)&#10;                    )&#10;                    restrictionData.forEach { (key, value) -&gt;&#10;                        RestrictionDataRow(key, value, extraColors)&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card for each step's data (SAME AS REVIEW STEP)&#10; */&#10;@Composable&#10;private fun ExpandableStepCard(&#10;    step: StepData,&#10;    stepFieldsWithData: List&lt;com.informatique.mtcit.common.FormField&gt;,&#10;    formData: Map&lt;String, String&gt;,&#10;    isExpandedByDefault: Boolean,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(isExpandedByDefault) }&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth().padding(vertical = 4.dp),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        elevation = CardDefaults.cardElevation(0.dp),&#10;        shape = RoundedCornerShape(14.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Column(modifier = Modifier.weight(1f)) {&#10;                    Text(&#10;                        text = localizedApp(step.titleRes).replace(Regex(&quot;^(Choose|Select|Enter|اختر|أدخل)\\s+&quot;, RegexOption.IGNORE_CASE), &quot;&quot;).trim(),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Medium),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Spacer(modifier = Modifier.width(12.dp))&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode,&#10;                    modifier = Modifier.padding(6.dp)&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(&#10;                    modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)&#10;                ) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 16.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.2f),&#10;                        thickness = 1.dp&#10;                    )&#10;&#10;                    // Display fields using the shared component&#10;                    Column(&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;                    ) {&#10;                        stepFieldsWithData.forEach { field -&gt;&#10;                            val value = formData[field.id] ?: &quot;&quot;&#10;                            FormFieldDisplayItem(&#10;                                label = if (field.labelRes != 0) localizedApp(field.labelRes) else field.label,&#10;                                value = value,&#10;                                field = field&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ReasonItem(&#10;    reason: String,&#10;    detailedMessage: String,&#10;    index: Int,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Row(verticalAlignment = Alignment.Top) {&#10;            Surface(&#10;                modifier = Modifier.size(28.dp),&#10;                shape = RoundedCornerShape(14.dp),&#10;                color = Color(0xFFFF9800).copy(alpha = 0.2f)&#10;            ) {&#10;                Box(contentAlignment = Alignment.Center, modifier = Modifier.fillMaxSize()) {&#10;                    Text(&#10;                        text = index.toString(),&#10;                        style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = Color(0xFFFF9800)&#10;                    )&#10;                }&#10;            }&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&#10;                    text = reason,&#10;                    style = MaterialTheme.typography.bodyLarge.copy(fontWeight = FontWeight.Medium),&#10;                    color = extraColors.whiteInDarkMode&#10;                )&#10;                if (detailedMessage.isNotBlank()) {&#10;                    Spacer(modifier = Modifier.height(4.dp))&#10;                    Text(&#10;                        text = detailedMessage,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = extraColors.textSubTitle&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun RestrictionDataRow(&#10;    label: String,&#10;    value: String,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    Row(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        horizontalArrangement = Arrangement.SpaceBetween&#10;    ) {&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            color = extraColors.textSubTitle,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;        Text(&#10;            text = value,&#10;            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium),&#10;            color = extraColors.whiteInDarkMode,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card showing captured data at the point of rejection&#10; */&#10;@Composable&#10;private fun CapturedDataCard(&#10;    capturedData: Map&lt;String, String&gt;,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(true) } // Expanded by default&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Info,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFF4CAF50),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = localizedApp(R.string.captured_data),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 12.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.1f)&#10;                    )&#10;                    capturedData.forEach { (key, value) -&gt;&#10;                        CapturedDataRow(key, value, extraColors)&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun CapturedDataRow(&#10;    label: String,&#10;    value: String,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    // Try to parse JSON and extract meaningful data&#10;    val displayValue = remember(value) {&#10;        when {&#10;            // Check if value is JSON (starts with { and ends with })&#10;            value.startsWith(&quot;{&quot;) &amp;&amp; value.endsWith(&quot;}&quot;) -&gt; {&#10;                try {&#10;                    val json = kotlinx.serialization.json.Json { ignoreUnknownKeys = true; isLenient = true }&#10;&#10;                    // Try to parse as PersonType&#10;                    val personType = try {&#10;                        json.decodeFromString&lt;PersonType&gt;(value)&#10;                    } catch (e: Exception) {&#10;                        null&#10;                    }&#10;&#10;                    if (personType != null) {&#10;                        personType.title // Extract title from PersonType&#10;                    } else {&#10;                        // Try to parse as SelectableItem&#10;                        val selectableItem = try {&#10;                            json.decodeFromString&lt;SelectableItem&gt;(value)&#10;                        } catch (e: Exception) {&#10;                            null&#10;                        }&#10;&#10;                        if (selectableItem != null) {&#10;                            selectableItem.title // Extract title from SelectableItem&#10;                        } else {&#10;                            // Fallback: show raw value&#10;                            value&#10;                        }&#10;                    }&#10;                } catch (e: Exception) {&#10;                    value // Fallback to raw value if parsing fails&#10;                }&#10;            }&#10;            else -&gt; value // Not JSON, display as-is&#10;        }&#10;    }&#10;&#10;    Row(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        horizontalArrangement = Arrangement.SpaceBetween&#10;    ) {&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            color = extraColors.textSubTitle,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;        Text(&#10;            text = displayValue,&#10;            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium),&#10;            color = extraColors.whiteInDarkMode,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.informatique.mtcit.ui.components&#10;&#10;import androidx.compose.animation.AnimatedVisibility&#10;import androidx.compose.animation.expandVertically&#10;import androidx.compose.animation.fadeIn&#10;import androidx.compose.animation.fadeOut&#10;import androidx.compose.animation.shrinkVertically&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Cancel&#10;import androidx.compose.material.icons.filled.Info&#10;import androidx.compose.material.icons.filled.KeyboardArrowDown&#10;import androidx.compose.material.icons.filled.KeyboardArrowUp&#10;import androidx.compose.material.icons.filled.Warning&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.informatique.mtcit.R&#10;import com.informatique.mtcit.ui.theme.LocalExtraColors&#10;import com.informatique.mtcit.ui.viewmodels.StepData&#10;import com.informatique.mtcit.ui.components.shared.FormFieldDisplayItem&#10;&#10;/**&#10; * Rejection Step Content Component&#10; * Works like ReviewStepContent but adds rejection reasons and restriction details&#10; * Automatically displays ALL data from previous steps&#10; */&#10;@Composable&#10;fun RejectionStepContent(&#10;    stepData: StepData,&#10;    formData: Map&lt;String, String&gt;,&#10;    allSteps: List&lt;StepData&gt;,&#10;    onBackToHome: () -&gt; Unit,&#10;    onContactSupport: () -&gt; Unit,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    val extraColors = LocalExtraColors.current&#10;&#10;    // Extract metadata&#10;    val reasons = (stepData.metadata?.get(&quot;reasons&quot;) as? List&lt;*&gt;)?.filterIsInstance&lt;String&gt;() ?: emptyList()&#10;    val detailedMessages = (stepData.metadata?.get(&quot;detailedMessages&quot;) as? List&lt;*&gt;)?.filterIsInstance&lt;String&gt;() ?: emptyList()&#10;    val restrictionData = (stepData.metadata?.get(&quot;restrictionData&quot;) as? Map&lt;*, *&gt;)&#10;        ?.mapNotNull { (key, value) -&gt;&#10;            if (key != null &amp;&amp; value != null) key.toString() to value.toString() else null&#10;        }?.toMap()&#10;    val capturedData = (stepData.metadata?.get(&quot;capturedData&quot;) as? Map&lt;*, *&gt;)&#10;        ?.mapNotNull { (key, value) -&gt;&#10;            if (key != null &amp;&amp; value != null) key.toString() to value.toString() else null&#10;        }?.toMap() ?: emptyMap()&#10;    val canGoBack = stepData.metadata?.get(&quot;canGoBack&quot;) as? Boolean ?: true&#10;&#10;    // DEBUG LOG&#10;    android.util.Log.d(&quot;RejectionStepContent&quot;, &quot;Extracted capturedData: $capturedData&quot;)&#10;&#10;    Column(&#10;        modifier = modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp), // ✅ REMOVED verticalScroll() - parent already scrolls&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        // 1. Rejection Icon and Title&#10;        Card(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            colors = CardDefaults.cardColors(containerColor = Color(0xFFFFEBEE)),&#10;            shape = RoundedCornerShape(12.dp)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.fillMaxWidth().padding(20.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Icon(&#10;                    imageVector = Icons.Default.Cancel,&#10;                    contentDescription = null,&#10;                    tint = Color(0xFFD32F2F),&#10;                    modifier = Modifier.size(64.dp)&#10;                )&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;                Text(&#10;                    text = localizedApp(R.string.request_rejected_title),&#10;                    style = MaterialTheme.typography.headlineSmall.copy(fontWeight = FontWeight.Bold),&#10;                    color = Color(0xFFD32F2F)&#10;                )&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Text(&#10;                    text = localizedApp(R.string.request_rejected_desc),&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = extraColors.textSubTitle&#10;                )&#10;            }&#10;        }&#10;&#10;        // 2. Rejection Reasons (Expandable)&#10;        if (reasons.isNotEmpty()) {&#10;            RejectionReasonsCard(reasons, detailedMessages, extraColors)&#10;        }&#10;&#10;        // 3. Restriction Details (Expandable)&#10;        restrictionData?.let {&#10;            if (it.isNotEmpty()) {&#10;                RestrictionDetailsCard(it, extraColors)&#10;            }&#10;        }&#10;&#10;        // 3.5. Captured Data at Point of Rejection (NEW - shows custom data with Arabic labels)&#10;        if (capturedData.isNotEmpty()) {&#10;            CapturedDataCard(capturedData, extraColors)&#10;        }&#10;&#10;        // 4. Entered Data Summary - SAME AS REVIEW STEP (Expandable sections per step)&#10;        Text(&#10;            text = localizedApp(R.string.entered_data_summary),&#10;            style = MaterialTheme.typography.titleLarge.copy(fontWeight = FontWeight.Bold),&#10;            color = extraColors.whiteInDarkMode,&#10;            modifier = Modifier.padding(top = 8.dp)&#10;        )&#10;&#10;        // Display all previous steps data (excluding rejection step itself)&#10;        allSteps.forEachIndexed { index, step -&gt;&#10;            // Skip the rejection step itself and empty steps&#10;            if (step.metadata?.get(&quot;isRejectionStep&quot;) != true &amp;&amp; step.fields.isNotEmpty()) {&#10;                val stepFieldsWithData = step.fields.filter { field -&gt;&#10;                    val value = formData[field.id]&#10;                    !value.isNullOrBlank() &amp;&amp; value != &quot;[]&quot;&#10;                }&#10;&#10;                if (stepFieldsWithData.isNotEmpty()) {&#10;                    ExpandableStepCard(&#10;                        step = step,&#10;                        stepFieldsWithData = stepFieldsWithData,&#10;                        formData = formData,&#10;                        isExpandedByDefault = false, // All collapsed by default in rejection step&#10;                        extraColors = extraColors&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        // 5. Action Buttons&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        Column(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            verticalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            if (canGoBack) {&#10;                Button(&#10;                    onClick = { /* Will be handled by previousStep in ViewModel */ },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = ButtonDefaults.buttonColors(containerColor = extraColors.blue2),&#10;                    shape = RoundedCornerShape(12.dp)&#10;                ) {&#10;                    Text(&#10;                        text = localizedApp(R.string.go_back_and_fix),&#10;                        modifier = Modifier.padding(vertical = 8.dp)&#10;                    )&#10;                }&#10;            }&#10;&#10;            OutlinedButton(&#10;                onClick = onBackToHome,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                shape = RoundedCornerShape(12.dp)&#10;            ) {&#10;                Text(&#10;                    text = localizedApp(R.string.back_to_home),&#10;                    modifier = Modifier.padding(vertical = 8.dp)&#10;                )&#10;            }&#10;&#10;            OutlinedButton(&#10;                onClick = onContactSupport,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                shape = RoundedCornerShape(12.dp)&#10;            ) {&#10;                Text(&#10;                    text = localizedApp(R.string.contact_support),&#10;                    modifier = Modifier.padding(vertical = 8.dp)&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card showing rejection reasons&#10; */&#10;@Composable&#10;private fun RejectionReasonsCard(&#10;    reasons: List&lt;String&gt;,&#10;    detailedMessages: List&lt;String&gt;,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(true) } // Expanded by default&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Warning,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFFFF9800),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = localizedApp(R.string.rejection_reasons),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 12.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.1f)&#10;                    )&#10;                    reasons.forEachIndexed { index, reason -&gt;&#10;                        ReasonItem(reason, detailedMessages.getOrNull(index) ?: &quot;&quot;, index + 1, extraColors)&#10;                        if (index &lt; reasons.size - 1) {&#10;                            Spacer(modifier = Modifier.height(12.dp))&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card showing restriction details from API/backend&#10; */&#10;@Composable&#10;private fun RestrictionDetailsCard(&#10;    restrictionData: Map&lt;String, String&gt;,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(true) } // Expanded by default&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Info,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFF2196F3),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = localizedApp(R.string.restriction_details),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 12.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.1f)&#10;                    )&#10;                    restrictionData.forEach { (key, value) -&gt;&#10;                        RestrictionDataRow(key, value, extraColors)&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card for each step's data (SAME AS REVIEW STEP)&#10; */&#10;@Composable&#10;private fun ExpandableStepCard(&#10;    step: StepData,&#10;    stepFieldsWithData: List&lt;com.informatique.mtcit.common.FormField&gt;,&#10;    formData: Map&lt;String, String&gt;,&#10;    isExpandedByDefault: Boolean,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(isExpandedByDefault) }&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth().padding(vertical = 4.dp),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        elevation = CardDefaults.cardElevation(0.dp),&#10;        shape = RoundedCornerShape(14.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Column(modifier = Modifier.weight(1f)) {&#10;                    Text(&#10;                        text = localizedApp(step.titleRes).replace(Regex(&quot;^(Choose|Select|Enter|اختر|أدخل)\\s+&quot;, RegexOption.IGNORE_CASE), &quot;&quot;).trim(),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Medium),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Spacer(modifier = Modifier.width(12.dp))&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode,&#10;                    modifier = Modifier.padding(6.dp)&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(&#10;                    modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)&#10;                ) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 16.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.2f),&#10;                        thickness = 1.dp&#10;                    )&#10;&#10;                    // Display fields using the shared component&#10;                    Column(&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;                    ) {&#10;                        stepFieldsWithData.forEach { field -&gt;&#10;                            val value = formData[field.id] ?: &quot;&quot;&#10;                            FormFieldDisplayItem(&#10;                                label = if (field.labelRes != 0) localizedApp(field.labelRes) else field.label,&#10;                                value = value,&#10;                                field = field&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ReasonItem(&#10;    reason: String,&#10;    detailedMessage: String,&#10;    index: Int,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Row(verticalAlignment = Alignment.Top) {&#10;            Surface(&#10;                modifier = Modifier.size(28.dp),&#10;                shape = RoundedCornerShape(14.dp),&#10;                color = Color(0xFFFF9800).copy(alpha = 0.2f)&#10;            ) {&#10;                Box(contentAlignment = Alignment.Center, modifier = Modifier.fillMaxSize()) {&#10;                    Text(&#10;                        text = index.toString(),&#10;                        style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = Color(0xFFFF9800)&#10;                    )&#10;                }&#10;            }&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&#10;                    text = reason,&#10;                    style = MaterialTheme.typography.bodyLarge.copy(fontWeight = FontWeight.Medium),&#10;                    color = extraColors.whiteInDarkMode&#10;                )&#10;                if (detailedMessage.isNotBlank()) {&#10;                    Spacer(modifier = Modifier.height(4.dp))&#10;                    Text(&#10;                        text = detailedMessage,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = extraColors.textSubTitle&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun RestrictionDataRow(&#10;    label: String,&#10;    value: String,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    Row(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        horizontalArrangement = Arrangement.SpaceBetween&#10;    ) {&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            color = extraColors.textSubTitle,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;        Text(&#10;            text = value,&#10;            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium),&#10;            color = extraColors.whiteInDarkMode,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Expandable card showing captured data at the point of rejection&#10; */&#10;@Composable&#10;private fun CapturedDataCard(&#10;    capturedData: Map&lt;String, String&gt;,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    var isExpanded by remember { mutableStateOf(true) } // Expanded by default&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(containerColor = extraColors.cardBackground),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column {&#10;            // Clickable Header&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .clickable { isExpanded = !isExpanded }&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Info,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFF4CAF50),&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = localizedApp(R.string.captured_data),&#10;                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),&#10;                        color = extraColors.whiteInDarkMode&#10;                    )&#10;                }&#10;                Icon(&#10;                    imageVector = if (isExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown,&#10;                    contentDescription = null,&#10;                    tint = extraColors.whiteInDarkMode&#10;                )&#10;            }&#10;&#10;            // Expandable Content&#10;            AnimatedVisibility(&#10;                visible = isExpanded,&#10;                enter = expandVertically() + fadeIn(),&#10;                exit = shrinkVertically() + fadeOut()&#10;            ) {&#10;                Column(modifier = Modifier.fillMaxWidth().padding(start = 16.dp, end = 16.dp, bottom = 16.dp)) {&#10;                    HorizontalDivider(&#10;                        modifier = Modifier.padding(bottom = 12.dp),&#10;                        color = extraColors.whiteInDarkMode.copy(alpha = 0.1f)&#10;                    )&#10;                    capturedData.forEach { (key, value) -&gt;&#10;                        CapturedDataRow(key, value, extraColors)&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun CapturedDataRow(&#10;    label: String,&#10;    value: String,&#10;    extraColors: com.informatique.mtcit.ui.theme.ExtraColors&#10;) {&#10;    // Try to parse JSON and extract meaningful data&#10;    val displayValue = remember(value) {&#10;        when {&#10;            // Check if value is JSON (starts with { and ends with })&#10;            value.startsWith(&quot;{&quot;) &amp;&amp; value.endsWith(&quot;}&quot;) -&gt; {&#10;                try {&#10;                    val json = kotlinx.serialization.json.Json { ignoreUnknownKeys = true; isLenient = true }&#10;&#10;                    // Try to parse as PersonType&#10;                    val personType = try {&#10;                        json.decodeFromString&lt;PersonType&gt;(value)&#10;                    } catch (e: Exception) {&#10;                        null&#10;                    }&#10;&#10;                    if (personType != null) {&#10;                        personType.title // Extract title from PersonType&#10;                    } else {&#10;                        // Try to parse as SelectableItem&#10;                        val selectableItem = try {&#10;                            json.decodeFromString&lt;SelectableItem&gt;(value)&#10;                        } catch (e: Exception) {&#10;                            null&#10;                        }&#10;&#10;                        if (selectableItem != null) {&#10;                            selectableItem.title // Extract title from SelectableItem&#10;                        } else {&#10;                            // Fallback: show raw value&#10;                            value&#10;                        }&#10;                    }&#10;                } catch (e: Exception) {&#10;                    value // Fallback to raw value if parsing fails&#10;                }&#10;            }&#10;            else -&gt; value // Not JSON, display as-is&#10;        }&#10;    }&#10;&#10;    Row(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        horizontalArrangement = Arrangement.SpaceBetween&#10;    ) {&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            color = extraColors.textSubTitle,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;        Text(&#10;            text = displayValue,&#10;            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium),&#10;            color = extraColors.whiteInDarkMode,&#10;            modifier = Modifier.weight(1f)&#10;        )&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>